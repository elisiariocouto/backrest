function e(e,t,r,l){Object.defineProperty(e,t,{get:r,set:l,enumerable:!0,configurable:!0})}function t(e){return e&&e.__esModule?e.default:e}var r=globalThis.parcelRequire233b,l=r.register;l("gJs7p",function(t,l){e(t.exports,"AddRepoModal",()=>F);var a=r("ayMG0"),i=r("4Uh7a"),s=r("iJ95P"),n=r("1gKZf"),o=r("bAJM4"),d=r("4To0s"),c=r("eTcXV"),u=r("6LHLJ"),h=r("jCenh"),p=r("3VOgd"),f=r("2lwvh"),m=r("VoMtX"),x=r("93lJr"),g=r("acw62"),y=r("dkYnv"),j=r("6Os56"),C=r("8ffPJ"),b=r("bDRCH"),v=r("54UqH"),S=r("8p4qI"),w=r("3JMMO"),E=r("lK1ug"),I=r("1Yxub"),_=r("8kspG"),k=r("2qtef"),R=r("1VQWV"),O=r("bmbyS"),A=r("3xSyo"),P=r("lPKqJ"),T=r("4l8Tp"),U=r("7nu3T");let N=(0,P.create)(j.RepoSchema,{prunePolicy:{maxUnusedPercent:10,schedule:{schedule:{case:"cron",value:"0 0 1 * *"},clock:j.Schedule_Clock.LAST_RUN_TIME}},checkPolicy:{schedule:{schedule:{case:"cron",value:"0 0 1 * *"},clock:j.Schedule_Clock.LAST_RUN_TIME}},commandPrefix:{ioNice:j.CommandPrefix_IONiceLevel.IO_DEFAULT,cpuNice:j.CommandPrefix_CPUNiceLevel.CPU_DEFAULT}}),F=({template:e})=>{let[t,r]=(0,g.useState)(!1),l=(0,y.useShowModal)(),u=(0,w.useAlertApi)(),[F,L]=(0,R.useConfig)(),[B]=d.default.useForm();if((0,g.useEffect)(()=>{let t=e?(0,U.toJson)(j.RepoSchema,e,{alwaysEmitImplicit:!0}):(0,U.toJson)(j.RepoSchema,N,{alwaysEmitImplicit:!0});B.setFieldsValue(t)},[e]),!F)return null;let V=async()=>{r(!0);try{L(await I.backrestService.removeRepo((0,P.create)(C.StringValueSchema,{value:e.id}))),l(null),u.success("Deleted repo "+e.id+" from config but files remain. To release storage delete the files manually. URI: "+e.uri)}catch(e){u.error((0,w.formatErrorAlert)(e,"Operation error: "),15)}finally{r(!1)}},W=async()=>{r(!0);try{let t=await (0,E.validateForm)(B),r=(0,T.fromJson)(j.RepoSchema,t,{ignoreUnknownFields:!1});null!==e?(L(await I.backrestService.addRepo(r)),l(null),u.success("Updated repo configuration "+r.uri)):(L(await I.backrestService.addRepo(r)),l(null),u.success("Added repo "+r.uri));try{await I.backrestService.listSnapshots({repoId:r.id})}catch(e){u.error((0,w.formatErrorAlert)(e,"Failed to list snapshots for updated/added repo: "),10)}}catch(e){u.error((0,w.formatErrorAlert)(e,"Operation error: "),10)}finally{r(!1)}},J=()=>{l(null)};return(0,a.jsx)(a.Fragment,{children:(0,a.jsxs)(h.default,{open:!0,onCancel:J,title:e?"Edit Restic Repository":"Add Restic Repository",width:"60vw",footer:[(0,a.jsx)(i.default,{loading:t,onClick:J,children:"Cancel"},"back"),null!=e?(0,a.jsx)(m.default,{title:"Removes the repo from the config but will not delete the restic repository",children:(0,a.jsx)(k.ConfirmButton,{type:"primary",danger:!0,onClickAsync:V,confirmTitle:"Confirm Delete",children:"Delete"},"delete")},"delete-tooltip"):null,(0,a.jsx)(k.SpinButton,{onClickAsync:async()=>{let e=await (0,E.validateForm)(B);console.log("checking repo",e);let t=(0,T.fromJson)(j.RepoSchema,e,{ignoreUnknownFields:!1});try{(await I.backrestService.checkRepoExists(t)).value?u.success("Connected successfully to "+t.uri+" and found an existing repo.",10):u.success("Connected successfully to "+t.uri+". No existing repo found at this location, a new one will be initialized",10)}catch(e){u.error((0,w.formatErrorAlert)(e,"Check error: "),10)}},children:"Test Configuration"},"check"),(0,a.jsx)(i.default,{type:"primary",loading:t,onClick:W,children:"Submit"},"submit")],maskClosable:!1,children:[(0,a.jsxs)("p",{children:["See"," ",(0,a.jsx)("a",{href:"https://garethgeorge.github.io/backrest/introduction/getting-started",target:"_blank",children:"backrest getting started guide"})," ","for repository configuration instructions or check the"," ",(0,a.jsx)("a",{href:"https://restic.readthedocs.io/",target:"_blank",children:"restic documentation"})," ","for more details about repositories."]}),(0,a.jsx)("br",{}),(0,a.jsxs)(d.default,{autoComplete:"off",form:B,labelCol:{span:4},wrapperCol:{span:18},disabled:t,children:[(0,a.jsx)(m.default,{title:"Unique ID that identifies this repo in the backrest UI (e.g. s3-mybucket). This cannot be changed after creation.",children:(0,a.jsx)(d.default.Item,{hasFeedback:!0,name:"id",label:"Repo Name",validateTrigger:["onChange","onBlur"],rules:[{required:!0,message:"Please input repo name"},{validator:async(t,r)=>{if(!e&&F?.repos?.find(e=>e.id===r))throw Error()},message:"Repo with name already exists"},{pattern:E.namePattern,message:"Name must be alphanumeric with dashes or underscores as separators"}],children:(0,a.jsx)(c.default,{disabled:!!e,placeholder:"repo"+((F?.repos?.length||0)+1)})})}),(0,a.jsx)(d.default.Item,{name:"guid",hidden:!0,children:(0,a.jsx)(c.default,{})}),(0,a.jsx)(m.default,{title:(0,a.jsxs)(a.Fragment,{children:["Valid Repo URIs are:",(0,a.jsxs)("ul",{children:[(0,a.jsx)("li",{children:"Local filesystem path"}),(0,a.jsx)("li",{children:"S3 e.g. s3:// ..."}),(0,a.jsx)("li",{children:"SFTP e.g. sftp:user@host:/repo-path"}),(0,a.jsxs)("li",{children:["See"," ",(0,a.jsx)("a",{href:"https://restic.readthedocs.io/en/latest/030_preparing_a_new_repo.html#preparing-a-new-repository",target:"_blank",children:"restic docs"})," ","for more info."]})]})]}),children:(0,a.jsx)(d.default.Item,{hasFeedback:!0,name:"uri",label:"Repository URI",validateTrigger:["onChange","onBlur"],rules:[{required:!0,message:"Please input repo URI"}],children:(0,a.jsx)(b.URIAutocomplete,{disabled:!!e})})}),(0,a.jsx)(m.default,{title:(0,a.jsxs)(a.Fragment,{children:["This password that encrypts data in your repository.",(0,a.jsxs)("ul",{children:[(0,a.jsx)("li",{children:"Recommended to pick a value that is 128 bits of entropy (20 chars or longer)"}),(0,a.jsx)("li",{children:"You may alternatively provide env variable credentials e.g. RESTIC_PASSWORD, RESTIC_PASSWORD_FILE, or RESTIC_PASSWORD_COMMAND."}),(0,a.jsx)("li",{children:"Click [Generate] to seed a random password from your browser's crypto random API."})]})]}),children:(0,a.jsx)(d.default.Item,{label:"Password",children:(0,a.jsxs)(p.default,{children:[(0,a.jsx)(n.default,{span:16,children:(0,a.jsx)(d.default.Item,{hasFeedback:!0,name:"password",validateTrigger:["onChange","onBlur"],children:(0,a.jsx)(c.default,{disabled:!!e})})}),(0,a.jsx)(n.default,{span:7,offset:1,style:{display:"flex",justifyContent:"left"},children:(0,a.jsx)(i.default,{type:"text",onClick:()=>{e||B.setFieldsValue({password:M()})},children:"[Generate]"})})]})})}),(0,a.jsx)(m.default,{title:"Environment variables that are passed to restic (e.g. to provide S3 or B2 credentials). References to parent-process env variables are supported as FOO=${MY_FOO_VAR}.",children:(0,a.jsx)(d.default.Item,{label:"Env Vars",children:(0,a.jsx)(d.default.List,{name:"env",rules:[{validator:async(e,t)=>await D(B,t)}],children:(e,{add:t,remove:r},{errors:l})=>(0,a.jsxs)(a.Fragment,{children:[e.map((e,t)=>{let{key:l,...i}=e;return(0,a.jsxs)(d.default.Item,{children:[(0,a.jsx)(d.default.Item,{...i,validateTrigger:["onChange","onBlur"],rules:[{required:!0,whitespace:!0,pattern:/^[\w-]+=.*$/,message:"Environment variable must be in format KEY=VALUE"}],noStyle:!0,children:(0,a.jsx)(c.default,{placeholder:"KEY=VALUE",onBlur:()=>B.validateFields(),style:{width:"90%"}})}),(0,a.jsx)(v.default,{className:"dynamic-delete-button",onClick:()=>r(t),style:{paddingLeft:"5px"}})]},e.key)}),(0,a.jsxs)(d.default.Item,{children:[(0,a.jsx)(i.default,{type:"dashed",onClick:()=>t(""),style:{width:"90%"},icon:(0,a.jsx)(S.default,{}),children:"Set Environment Variable"}),(0,a.jsx)(d.default.ErrorList,{errors:l})]})]})})})}),(0,a.jsx)(d.default.Item,{label:"Flags",children:(0,a.jsx)(d.default.List,{name:"flags",children:(e,{add:t,remove:r},{errors:l})=>(0,a.jsxs)(a.Fragment,{children:[e.map((e,t)=>{let{key:l,...i}=e;return(0,a.jsxs)(d.default.Item,{required:!1,children:[(0,a.jsx)(d.default.Item,{...i,validateTrigger:["onChange","onBlur"],rules:[{required:!0,whitespace:!0,pattern:/^\-\-?.*$/,message:"Value should be a CLI flag e.g. see restic --help"}],noStyle:!0,children:(0,a.jsx)(c.default,{placeholder:"--flag",style:{width:"90%"}})}),(0,a.jsx)(v.default,{className:"dynamic-delete-button",onClick:()=>r(t),style:{paddingLeft:"5px"}})]},e.key)}),(0,a.jsxs)(d.default.Item,{children:[(0,a.jsx)(i.default,{type:"dashed",onClick:()=>t(),style:{width:"90%"},icon:(0,a.jsx)(S.default,{}),children:"Set Flag"}),(0,a.jsx)(d.default.ErrorList,{errors:l})]})]})})}),(0,a.jsxs)(d.default.Item,{label:(0,a.jsx)(m.default,{title:(0,a.jsxs)("span",{children:["The schedule on which prune operations are run for this repository. Read"," ",(0,a.jsx)("a",{href:"https://restic.readthedocs.io/en/stable/060_forget.html#customize-pruning",target:"_blank",children:"the restic docs on customizing prune operations"})," ","for more details."]}),children:"Prune Policy"}),children:[(0,a.jsx)(d.default.Item,{name:["prunePolicy","maxUnusedPercent"],initialValue:10,required:!1,children:(0,a.jsx)(q,{addonBefore:(0,a.jsx)(m.default,{title:"The maximum percentage of the repo size that may be unused after a prune operation completes. High values reduce copying at the expense of storage.",children:(0,a.jsx)("div",{style:{width:"12"},children:"Max Unused After Prune"})})})}),(0,a.jsx)(O.ScheduleFormItem,{name:["prunePolicy","schedule"],defaults:O.ScheduleDefaultsInfrequent})]}),(0,a.jsxs)(d.default.Item,{label:(0,a.jsx)(m.default,{title:(0,a.jsx)("span",{children:"The schedule on which check operations are run for this repository. Restic check operations verify the integrity of your repository by scanning the on-disk structures that make up your backup data. Check can optionally be configured to re-read and re-hash data, this is slow and can be bandwidth expensive but will catch any bitrot or silent corruption in the storage medium."}),children:"Check Policy"}),children:[(0,a.jsx)(d.default.Item,{name:["checkPolicy","readDataSubsetPercent"],initialValue:0,required:!1,children:(0,a.jsx)(q,{addonBefore:(0,a.jsx)(m.default,{title:"The percentage of pack data in this repository that will be read and verified. Higher values will use more bandwidth (e.g. 100% will re-read the entire repository on each check).",children:(0,a.jsx)("div",{style:{width:"12"},children:"Read Data %"})})})}),(0,a.jsx)(O.ScheduleFormItem,{name:["checkPolicy","schedule"],defaults:O.ScheduleDefaultsInfrequent})]}),!A.isWindows&&(0,a.jsx)(d.default.Item,{label:(0,a.jsx)(m.default,{title:(0,a.jsx)("span",{children:"Modifiers for the backup operation e.g. set the CPU or IO priority."}),children:"Command Modifiers"}),colon:!1,children:(0,a.jsxs)(p.default,{children:[(0,a.jsx)(n.default,{span:12,style:{paddingLeft:"5px"},children:(0,a.jsxs)(m.default,{title:(0,a.jsxs)(a.Fragment,{children:["Available IO priority modes",(0,a.jsxs)("ul",{children:[(0,a.jsx)("li",{children:"IO_BEST_EFFORT_LOW - runs at lower than default disk priority (will prioritize other processes)"}),(0,a.jsx)("li",{children:"IO_BEST_EFFORT_HIGH - runs at higher than default disk priority (top of disk IO queue)"}),(0,a.jsx)("li",{children:"IO_IDLE - only runs when disk bandwidth is idle (e.g. no other operations are queued)"})]})]}),children:["IO Priority:",(0,a.jsx)("br",{}),(0,a.jsx)(d.default.Item,{name:["commandPrefix","ioNice"],required:!1,children:(0,a.jsx)(f.default,{allowClear:!0,style:{width:"100%"},placeholder:"Select an IO priority",options:j.CommandPrefix_IONiceLevelSchema.values.map(e=>({label:e.name,value:e.name}))})})]})}),(0,a.jsx)(n.default,{span:12,style:{paddingLeft:"5px"},children:(0,a.jsxs)(m.default,{title:(0,a.jsxs)(a.Fragment,{children:["Available CPU priority modes:",(0,a.jsxs)("ul",{children:[(0,a.jsx)("li",{children:"CPU_DEFAULT - no change in priority"}),(0,a.jsx)("li",{children:"CPU_HIGH - higher than default priority (backrest must be running as root)"}),(0,a.jsx)("li",{children:"CPU_LOW - lower than default priority"})]})]}),children:["CPU Priority:",(0,a.jsx)("br",{}),(0,a.jsx)(d.default.Item,{name:["commandPrefix","cpuNice"],required:!1,children:(0,a.jsx)(f.default,{allowClear:!0,style:{width:"100%"},placeholder:"Select a CPU priority",options:j.CommandPrefix_CPUNiceLevelSchema.values.map(e=>({label:e.name,value:e.name}))})})]})})]})}),(0,a.jsx)(d.default.Item,{label:(0,a.jsx)(m.default,{title:"Auto-unlock will remove lockfiles at the start of forget and prune operations. This is potentially unsafe if the repo is shared by multiple client devices. Disabled by default.",children:"Auto Unlock"}),name:"autoUnlock",valuePropName:"checked",children:(0,a.jsx)(s.default,{})}),(0,a.jsx)(d.default.Item,{label:(0,a.jsx)(m.default,{title:_.hooksListTooltipText,children:"Hooks"}),children:(0,a.jsx)(_.HooksFormList,{})}),(0,a.jsx)(d.default.Item,{shouldUpdate:!0,label:"Preview",children:()=>(0,a.jsx)(o.default,{size:"small",items:[{key:"1",label:"Repo Config as JSON",children:(0,a.jsx)(x.default,{children:(0,a.jsx)("pre",{children:JSON.stringify(B.getFieldsValue(),void 0,2)})})}]})})]})]})})},L={s3:[["AWS_ACCESS_KEY_ID","AWS_SECRET_ACCESS_KEY"],["AWS_SHARED_CREDENTIALS_FILE"]],b2:[["B2_ACCOUNT_ID","B2_ACCOUNT_KEY"]],azure:[["AZURE_ACCOUNT_NAME","AZURE_ACCOUNT_KEY"],["AZURE_ACCOUNT_NAME","AZURE_ACCOUNT_SAS"]],gs:[["GOOGLE_APPLICATION_CREDENTIALS","GOOGLE_PROJECT_ID"],["GOOGLE_ACCESS_TOKEN"]]},D=(e,t)=>{if(!t)return Promise.resolve();let r=e.getFieldValue("uri");if(!r)return Promise.resolve();let l=t.map(e=>{if(!e)return"";let t=e.indexOf("=");return -1===t?"":e.substring(0,t)}),a=e.getFieldValue("password");if((!a||0===a.length)&&!l.includes("RESTIC_PASSWORD")&&!l.includes("RESTIC_PASSWORD_COMMAND")&&!l.includes("RESTIC_PASSWORD_FILE"))return Promise.reject(Error("Missing repo password. Either provide a password or set one of the env variables RESTIC_PASSWORD, RESTIC_PASSWORD_COMMAND, RESTIC_PASSWORD_FILE."));let i=r.indexOf(":");return -1===i?Promise.resolve():B(r.substring(0,i),l)},M=()=>btoa(String.fromCharCode(...crypto.getRandomValues(new Uint8Array(64)))).slice(0,48),B=(e,t)=>{let r=L[e];if(!r)return Promise.resolve();let l=[];for(let e of r){let r=e.filter(e=>!t.includes(e));if(0===r.length)return Promise.resolve();r.length<e.length&&l.push(r)}return l.length||l.push(...r),Promise.reject(Error("Missing env vars "+V(l)+" for scheme "+e))},V=e=>e.map(e=>e.length>1?`[ ${e.join(", ")} ]`:e[0]).join(" or "),q=({...e})=>(0,a.jsx)(u.default,{step:1,min:0,max:100,precision:2,controls:!1,suffix:"%",...e})}),l("bDRCH",function(l,a){e(l.exports,"URIAutocomplete",()=>h);var i=r("ayMG0"),s=r("ahXgR"),n=r("acw62"),o=r("3xSyo"),d=r("1Yxub"),c=r("f1q41");let u=o.isWindows?"\\":"/",h=e=>{let[r,l]=(0,n.useState)(""),[a,h]=(0,n.useState)([]),[p,f]=(0,n.useState)([]);(0,n.useEffect)(()=>{f(a.filter(e=>-1!==e.value.indexOf(r)))},[a]);let m=t(c).debounce(e=>{l(e);let t=e.lastIndexOf(u);-1!==t&&(e=e.substring(0,t)),d.backrestService.pathAutocomplete({value:e+u}).then(t=>{t.values&&h(t.values.map(t=>({value:e+u+t})))}).catch(e=>{console.log("Path autocomplete error: ",e)})},200);return(0,i.jsx)(s.default,{options:p,onSearch:m,rules:[{validator:async(t,r)=>{if(e.globAllowed)return Promise.resolve();if(o.isWindows){if(r.match(/^[a-zA-Z]:\\$/))return Promise.reject(Error("Path must start with a drive letter e.g. C:\\"));else if(r.includes("/"))return Promise.reject(Error("Path must use backslashes e.g. C:\\Users\\MyUsers\\Documents"))}return Promise.resolve()}}],...e})}}),l("ahXgR",function(t,l){e(t.exports,"default",()=>u);var a=r("1pcHX"),i=r("ctW3E"),s=r("2lwvh"),n=r("lFZNR");let{Option:o}=s.default,d=(0,i.default)(n.default,"dropdownAlign",e=>(0,a.default)(e,["visible"])),c=n.default;c.Option=o,c._InternalPanelDoNotUseOrYouWillBeFired=d;var u=c}),l("lFZNR",function(l,a){e(l.exports,"default",()=>f);var i=r("acw62"),s=r("8g1PZ"),n=r("jWR62"),o=r("1pcHX"),d=r("brFSt"),c=r("aT8OD"),u=r("2lwvh");let{Option:h}=u.default;function p(e){return(null==e?void 0:e.type)&&(e.type.isSelectOption||e.type.isSelectOptGroup)}var f=i.forwardRef((e,r)=>{var l,a;let f,m,{prefixCls:x,className:g,popupClassName:y,dropdownClassName:j,children:C,dataSource:b,dropdownStyle:v,dropdownRender:S,popupRender:w,onDropdownVisibleChange:E,onOpenChange:I,styles:_,classNames:k}=e,R=(0,n.default)(C),O=(null==(l=null==_?void 0:_.popup)?void 0:l.root)||v,A=(null==(a=null==k?void 0:k.popup)?void 0:a.root)||y||j;1===R.length&&i.isValidElement(R[0])&&!p(R[0])&&([f]=R);let P=f?()=>f:void 0;m=R.length&&p(R[0])?C:b?b.map(e=>{if(i.isValidElement(e))return e;switch(typeof e){case"string":return i.createElement(h,{key:e,value:e},e);case"object":{let{value:t}=e;return i.createElement(h,{key:t,value:t},e.text)}default:return}}):[];let{getPrefixCls:T}=i.useContext(c.ConfigContext),U=T("select",x),[N]=(0,d.useZIndex)("SelectLike",null==O?void 0:O.zIndex);return i.createElement(u.default,Object.assign({ref:r,suffixIcon:null},(0,o.default)(e,["dataSource","dropdownClassName","popupClassName"]),{prefixCls:U,classNames:{popup:{root:A},root:null==k?void 0:k.root},styles:{popup:{root:Object.assign(Object.assign({},O),{zIndex:N})},root:null==_?void 0:_.root},className:t(s)(`${U}-auto-complete`,g),mode:u.default.SECRET_COMBOBOX_MODE_DO_NOT_USE,popupRender:w||S,onOpenChange:I||E,getInputElement:P}),m)})}),l("2qtef",function(l,a){e(l.exports,"SpinButton",()=>o),e(l.exports,"ConfirmButton",()=>d);var i=r("ayMG0"),s=r("acw62"),n=r("4Uh7a");let o=t(s).forwardRef(({onClickAsync:e,...t},r)=>{let[l,a]=(0,s.useState)(!1),o=async()=>{if(!l)try{a(!0),await e()}finally{a(!1)}};return(0,i.jsx)(n.default,{...t,ref:r,loading:l,onClick:o})});o.displayName="SpinButton";let d=t(s).forwardRef(({onClickAsync:e,confirmTimeout:t,confirmTitle:r,children:l,...a},n)=>{let[d,c]=(0,s.useState)(!1);void 0===t&&(t=2e3);let u=async()=>{if(!d){c(!0),setTimeout(()=>{c(!1)},t);return}c(!1),await e()};return(0,i.jsx)(o,{...a,ref:n,onClickAsync:u,children:d?r:l})});d.displayName="ConfirmButton"}),l("bUBaJ",function(t,l){e(t.exports,"default",()=>o);var a=r("8nd05"),i=r("acw62"),s=r("h6oXS"),n=r("adRcI"),o=i.forwardRef(function(e,t){return i.createElement(n.default,(0,a.default)({},e,{ref:t,icon:s.default}))})}),l("h6oXS",function(t,r){e(t.exports,"default",()=>l);var l={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M890.5 755.3L537.9 269.2c-12.8-17.6-39-17.6-51.7 0L133.5 755.3A8 8 0 00140 768h75c5.1 0 9.9-2.5 12.9-6.6L512 369.8l284.1 391.6c3 4.1 7.8 6.6 12.9 6.6h75c6.5 0 10.3-7.4 6.5-12.7z"}}]},name:"up",theme:"outlined"}});
//# sourceMappingURL=AddRepoModal.5652c44f.js.map
